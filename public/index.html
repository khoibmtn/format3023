<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒê·ªãnh d·∫°ng DOCX theo Qƒê 3023/BYT</title>
  <meta name="description" content="Process Microsoft Word documents with automated formatting">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --accent: #2563eb;
      --accent-hover: #3b82f6;
      --success: #22c55e;
      --error: #ef4444;
      --warning: #f59e0b;
      --border: #e2e8f0;
      --gradient-1: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      --shadow-glow: 0 0 40px rgba(37, 99, 235, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: white;
      color: var(--text-primary);
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }

    /* Header Section - White background */
    .header-section {
      background: white;
      padding: 1.5rem 2rem 2rem;
      max-width: 900px;
      margin: 0 auto;
    }

    /* Content Section - Gray background */
    .content-section {
      background: #f1f5f9;
      padding: 2rem;
      min-height: calc(100vh - 200px);
    }

    .content-wrapper {
      max-width: 900px;
      margin: 0 auto;
    }

    /* Header - Organization Name */
    .org-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .org-icon {
      width: 24px;
      height: 24px;
      color: #1e3a8a;
    }

    .org-name {
      font-size: 0.9rem;
      font-weight: 700;
      color: #1e3a8a;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    /* Main Content */
    .main-content {
      text-align: center;
      margin-bottom: 0;
    }

    .main-title {
      font-size: 1.6rem;
      font-weight: 700;
      color: #1e3a5f;
      margin-bottom: 0.75rem;
      line-height: 1.4;
    }

    .main-desc {
      color: #64748b;
      font-size: 0.95rem;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
    }

    /* View Management */
    .view {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .view.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Upload Zone */
    .upload-zone {
      background: #fffde7;
      border: 2px dashed var(--border);
      border-radius: 20px;
      padding: 3rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .upload-zone:hover,
    .upload-zone.dragover {
      border-color: var(--accent);
      background: rgba(99, 102, 241, 0.05);
      box-shadow: var(--shadow-glow);
    }

    .upload-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 1.5rem;
      background: var(--gradient-1);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .upload-icon svg {
      width: 32px;
      height: 32px;
      stroke: white;
    }

    .upload-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .upload-subtitle {
      color: var(--text-secondary);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .upload-link {
      color: var(--accent);
      font-weight: 500;
      cursor: pointer;
    }

    .upload-link:hover {
      text-decoration: underline;
    }

    .upload-separator {
      color: #94a3b8;
    }

    .gdrive-link {
      color: #64748b;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .gdrive-link:hover {
      color: var(--accent);
    }

    .gdrive-icon {
      vertical-align: middle;
    }

    #fileInput {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    /* File List */
    .file-list {
      margin-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
      padding-right: 0.5rem;
    }

    .file-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.6rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
      animation: slideIn 0.3s ease;
      transition: background 0.2s;
    }

    .file-item:hover {
      background: #e0f2fe;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .file-icon {
      width: 40px;
      height: 40px;
      background: rgba(99, 102, 241, 0.15);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .file-icon svg {
      width: 20px;
      height: 20px;
      stroke: var(--accent);
    }

    .file-info {
      flex: 1;
      min-width: 0;
    }

    .file-name {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .file-size {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .file-remove {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .file-remove:hover {
      background: rgba(239, 68, 68, 0.1);
      color: var(--error);
    }

    /* Buttons */
    .actions {
      margin-top: 1rem;
      display: flex;
      gap: 0.75rem;
    }

    .btn {
      flex: 1;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--gradient-1);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-glow);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-card);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #16a34a;
      transform: translateY(-2px);
    }

    .btn svg {
      width: 20px;
      height: 20px;
    }

    /* Processing View */
    .processing-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .processing-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .processing-subtitle {
      color: var(--text-secondary);
    }

    .result-list {
      margin-top: 1rem;
    }

    .result-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1rem;
    }

    .result-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .result-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .result-icon.pending {
      background: rgba(99, 102, 241, 0.2);
    }

    .result-icon.pending svg {
      stroke: var(--accent);
    }

    .result-icon.success {
      background: rgba(34, 197, 94, 0.2);
    }

    .result-icon.success svg {
      stroke: var(--success);
    }

    .result-icon.error {
      background: rgba(239, 68, 68, 0.2);
    }

    .result-icon.error svg {
      stroke: var(--error);
    }

    .result-icon svg {
      width: 18px;
      height: 18px;
    }

    .result-info {
      flex: 1;
      min-width: 0;
    }

    .result-name {
      font-weight: 500;
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .result-status {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .result-action {
      flex-shrink: 0;
    }

    .btn-download-small {
      background: var(--success);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.2s;
    }

    .btn-download-small:hover {
      background: #16a34a;
      transform: translateY(-1px);
    }

    .btn-download-small svg {
      width: 16px;
      height: 16px;
    }

    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--bg-secondary);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-1);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .progress-fill.complete {
      background: var(--success);
    }

    .progress-fill.error {
      background: var(--error);
    }

    /* Summary Card */
    .summary-card {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.05) 100%);
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 16px;
      padding: 1.5rem;
      margin-top: 2rem;
      text-align: center;
    }

    .summary-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 0.5rem;
    }

    .summary-text {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .summary-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Features */
    .features {
      margin-top: 3rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .feature {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem;
    }

    .feature-title {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .feature-desc {
      color: var(--text-secondary);
      font-size: 0.85rem;
      line-height: 1.5;
    }

    /* Top Actions Bar */
    .top-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .btn-back {
      background: #ea580c;
      border: none;
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .btn-back:hover {
      background: #c2410c;
      transform: translateY(-1px);
    }

    .btn-zip {
      background: var(--accent);
      border: none;
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.2s;
    }

    .btn-zip:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    footer {
      margin-top: auto;
      padding-top: 3rem;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }
  </style>
</head>

<body>
  <!-- Header Section - White Background -->
  <div class="header-section">
    <!-- Organization Header - Top Left -->
    <div class="org-header">
      <svg class="org-icon" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z" />
      </svg>
      <span class="org-name">TRUNG T√ÇM Y T·∫æ TH·ª¶Y NGUY√äN ‚Äì PH√íNG K·∫æ HO·∫†CH ‚Äì NGHI·ªÜP V·ª§</span>
    </div>

    <!-- Main Content - Centered -->
    <div class="main-content">
      <h1 class="main-title">·ª®ng d·ª•ng ƒë·ªãnh d·∫°ng t·ª± ƒë·ªông quy tr√¨nh k·ªπ thu·∫≠t theo Quy·∫øt ƒë·ªãnh 3023/Qƒê-BYT</h1>
      <p class="main-desc">·ª®ng d·ª•ng ch·ªâ ƒë·ªãnh d·∫°ng file, kh√¥ng thay ƒë·ªïi c·∫•u tr√∫c v√† n·ªôi dung file. T·∫£i 1 ho·∫∑c nhi·ªÅu file
        t·ª´ m√°y t√≠nh, ƒëi·ªán tho·∫°i, ho·∫∑c google driver</p>
    </div>
  </div>

  <!-- Content Section - Gray Background -->
  <div class="content-section">
    <div class="content-wrapper">
      <!-- VIEW 1: Upload View -->
      <div class="view active" id="uploadView">
        <div class="upload-zone" id="uploadZone">
          <input type="file" id="fileInput" accept=".docx" multiple>
          <div class="upload-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
          </div>
          <div class="upload-title">K√©o th·∫£ file quy tr√¨nh c√≥ ƒë·ªãnh d·∫°ng DOCX v√†o ƒë√¢y</div>
          <div class="upload-subtitle">
            <span class="upload-link">Nh·∫•n ƒë·ªÉ ch·ªçn file t·ª´ m√°y t√≠nh</span>
            <span class="upload-separator">ho·∫∑c</span>
            <span class="gdrive-link" id="gdriveBtn">
              ch·ªçn t·ª´ google driver
              <svg class="gdrive-icon" viewBox="0 0 24 24" width="20" height="20">
                <circle cx="12" cy="12" r="10" fill="#ea4335" />
                <path d="M12 6l4 7H8l4-7z" fill="white" />
                <path d="M8 13l-2 4h12l-2-4H8z" fill="white" />
              </svg>
            </span>
          </div>
        </div>

        <div class="actions" id="uploadActions" style="display: none;">
          <button class="btn btn-secondary" id="clearBtn">
            <svg fill="none" stroke="#ef4444" viewBox="0 0 24 24" width="18" height="18">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            X√≥a t·∫•t c·∫£
          </button>
          <button class="btn btn-primary" id="processBtn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            X·ª≠ l√Ω file
          </button>
        </div>

        <div class="file-list" id="fileList"></div>

        <div class="features" id="featuresSection">
          <div class="feature">
            <div class="feature-title">üìù X·ª≠ l√Ω vƒÉn b·∫£n</div>
            <div class="feature-desc">Chuy·ªÉn ng·∫Øt d√≤ng th√†nh ƒëo·∫°n vƒÉn, chu·∫©n h√≥a d·∫•u g·∫°ch ngang</div>
          </div>
          <div class="feature">
            <div class="feature-title">üî§ Chu·∫©n h√≥a font</div>
            <div class="feature-desc">Thi·∫øt l·∫≠p Times New Roman 14pt l√†m font m·∫∑c ƒë·ªãnh</div>
          </div>
          <div class="feature">
            <div class="feature-title">üìê ƒê·ªãnh d·∫°ng ƒëo·∫°n</div>
            <div class="feature-desc">√Åp d·ª•ng gi√£n d√≤ng, canh l·ªÅ, th·ª•t ƒë·∫ßu d√≤ng</div>
          </div>
          <div class="feature">
            <div class="feature-title">‚ú® Gi·ªØ nguy√™n ƒë·ªãnh d·∫°ng</div>
            <div class="feature-desc">B·∫£o to√†n in ƒë·∫≠m, nghi√™ng, g·∫°ch ch√¢n v√† t·∫•t c·∫£ ƒë·ªãnh d·∫°ng kh√°c</div>
          </div>
        </div>
      </div>

      <!-- VIEW 2: Processing/Results View -->
      <div class="view" id="resultsView">
        <div class="processing-header">
          <div class="processing-title" id="processingTitle">ƒêang x·ª≠ l√Ω...</div>
          <div class="processing-subtitle" id="processingSubtitle">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</div>
        </div>

        <!-- Top action bar: Back button (left) and Download All (right) -->
        <div class="top-actions" id="topActions"
          style="display: none; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <button class="btn-back" id="continueBtn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            X·ª≠ l√Ω file kh√°c
          </button>
          <button class="btn-zip" id="downloadAllBtn" style="display: none;">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            T·∫£i t·∫•t c·∫£ (ZIP)
          </button>
        </div>

        <div class="result-list" id="resultList"></div>

        <div class="summary-card" id="summaryCard" style="display: none;">
          <div class="summary-title" id="summaryTitle">‚úì Ho√†n th√†nh!</div>
          <div class="summary-text" id="summaryText">T·∫•t c·∫£ file ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng</div>
        </div>
      </div>
    </div>
    <!-- End content-wrapper -->
  </div>
  </div>
  <!-- End content-section -->

  <footer>Ph√≤ng K·∫ø ho·∫°ch - Nghi·ªáp v·ª• ‚Äî Trung t√¢m Y t·∫ø Th·ªßy Nguy√™n @2026</footer>

  <script>
    // Elements
    const uploadView = document.getElementById('uploadView');
    const resultsView = document.getElementById('resultsView');
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const uploadActions = document.getElementById('uploadActions');
    const clearBtn = document.getElementById('clearBtn');
    const processBtn = document.getElementById('processBtn');
    const resultList = document.getElementById('resultList');
    const processingTitle = document.getElementById('processingTitle');
    const processingSubtitle = document.getElementById('processingSubtitle');
    const summaryCard = document.getElementById('summaryCard');
    const summaryTitle = document.getElementById('summaryTitle');
    const summaryText = document.getElementById('summaryText');
    const downloadAllBtn = document.getElementById('downloadAllBtn');
    const continueBtn = document.getElementById('continueBtn');
    const topActions = document.getElementById('topActions');

    let files = [];
    let processedResults = [];

    // View switching
    function showView(viewId) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(viewId).classList.add('active');
    }

    // Drag and drop
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
      fileInput.value = '';
    });

    function handleFiles(newFiles) {
      for (const file of newFiles) {
        if (file.name.toLowerCase().endsWith('.docx')) {
          if (!files.find(f => f.name === file.name)) {
            files.push(file);
          }
        }
      }
      renderFileList();
    }

    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }

    function renderFileList() {
      fileList.innerHTML = files.map((file, index) => `
        <div class="file-item">
          <div class="file-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </div>
          <div class="file-info">
            <div class="file-name">${file.name}</div>
            <div class="file-size">${formatSize(file.size)}</div>
          </div>
          <button class="file-remove" onclick="removeFile(${index})">
            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
          </button>
        </div>
      `).join('');

      uploadActions.style.display = files.length > 0 ? 'flex' : 'none';
      document.getElementById('featuresSection').style.display = files.length > 0 ? 'none' : 'grid';
    }

    function removeFile(index) {
      files.splice(index, 1);
      renderFileList();
    }

    clearBtn.addEventListener('click', () => {
      files = [];
      renderFileList();
    });

    // Process files
    processBtn.addEventListener('click', async () => {
      if (files.length === 0) return;

      // Switch to results view
      showView('resultsView');
      processedResults = [];
      summaryCard.style.display = 'none';

      processingTitle.textContent = 'ƒêang x·ª≠ l√Ω...';
      processingSubtitle.textContent = `0/${files.length} file`;

      // Render initial result items
      resultList.innerHTML = files.map((file, index) => `
        <div class="result-item" id="result-${index}">
          <div class="result-header">
            <div class="result-icon pending" id="icon-${index}">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <div class="result-info">
              <div class="result-name">${file.name}</div>
              <div class="result-status" id="status-${index}">ƒêang ch·ªù...</div>
            </div>
            <div class="result-action" id="action-${index}"></div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-${index}" style="width: 0%"></div>
          </div>
        </div>
      `).join('');

      // Process each file
      let successCount = 0;
      let errorCount = 0;

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        updateFileStatus(i, 'processing', 'ƒêang x·ª≠ l√Ω...', 50);

        try {
          const formData = new FormData();
          formData.append('files', file);

          const response = await fetch('/api/process', {
            method: 'POST',
            body: formData
          });

          if (!response.ok) {
            throw new Error('Processing failed');
          }

          // Always use original filename from client (preserves Vietnamese)
          const filename = file.name;

          const blob = await response.blob();
          processedResults.push({ name: filename, blob, success: true });

          updateFileStatus(i, 'success', 'Ho√†n th√†nh', 100);
          addDownloadButton(i, filename, blob);
          successCount++;
        } catch (error) {
          processedResults.push({ name: file.name, error: error.message, success: false });
          updateFileStatus(i, 'error', 'L·ªói: ' + error.message, 100);
          errorCount++;
        }

        processingSubtitle.textContent = `${i + 1}/${files.length} file`;
      }

      // Show summary
      showSummary(successCount, errorCount);
    });

    function updateFileStatus(index, status, message, progress) {
      const icon = document.getElementById(`icon-${index}`);
      const statusEl = document.getElementById(`status-${index}`);
      const progressEl = document.getElementById(`progress-${index}`);

      icon.className = `result-icon ${status}`;

      if (status === 'success') {
        icon.innerHTML = `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>`;
        progressEl.className = 'progress-fill complete';
      } else if (status === 'error') {
        icon.innerHTML = `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`;
        progressEl.className = 'progress-fill error';
      }

      statusEl.textContent = message;
      progressEl.style.width = `${progress}%`;
    }

    function addDownloadButton(index, filename, blob) {
      const actionEl = document.getElementById(`action-${index}`);
      const btn = document.createElement('button');
      btn.className = 'btn-download-small';
      btn.innerHTML = `
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
        </svg>
        T·∫£i xu·ªëng
      `;
      btn.onclick = () => downloadFile(filename, blob);
      actionEl.appendChild(btn);
    }

    async function downloadFile(filename, blob) {
      try {
        // Use traditional download method to show in browser's download bar
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        // Delay revoking to ensure download starts
        setTimeout(() => URL.revokeObjectURL(url), 1000);
      } catch (error) {
        console.error('Download error:', error);
      }
    }

    function showSummary(successCount, errorCount) {
      processingTitle.textContent = 'X·ª≠ l√Ω ho√†n t·∫•t!';
      processingSubtitle.textContent = '';

      // Show top action bar
      topActions.style.display = 'flex';

      summaryCard.style.display = 'block';

      if (errorCount === 0) {
        summaryTitle.textContent = `‚úì Ho√†n th√†nh ${successCount} file`;
        summaryText.textContent = 'T·∫•t c·∫£ file ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω th√†nh c√¥ng';
      } else if (successCount === 0) {
        summaryTitle.textContent = '‚úó L·ªói';
        summaryText.textContent = `Kh√¥ng th·ªÉ x·ª≠ l√Ω ${errorCount} file`;
        summaryCard.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%)';
        summaryCard.style.borderColor = 'rgba(239, 68, 68, 0.3)';
        summaryTitle.style.color = 'var(--error)';
      } else {
        summaryTitle.textContent = `‚úì Ho√†n th√†nh ${successCount}/${successCount + errorCount} file`;
        summaryText.textContent = `${errorCount} file kh√¥ng th·ªÉ x·ª≠ l√Ω`;
      }

      // Show download all button if multiple successful files
      if (successCount > 1) {
        downloadAllBtn.style.display = 'flex';
      }
    }

    // Download all as ZIP
    downloadAllBtn.addEventListener('click', async () => {
      // Create ZIP using JSZip (loaded dynamically)
      if (!window.JSZip) {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
        document.head.appendChild(script);
        await new Promise(resolve => script.onload = resolve);
      }

      const zip = new JSZip();
      const successfulFiles = processedResults.filter(r => r.success);

      for (const file of successfulFiles) {
        zip.file(file.name, file.blob);
      }

      const zipBlob = await zip.generateAsync({ type: 'blob' });
      const today = new Date();
      const dateStr = today.getFullYear().toString() +
        String(today.getMonth() + 1).padStart(2, '0') +
        String(today.getDate()).padStart(2, '0');
      downloadFile(`${dateStr} file ƒë√£ x·ª≠ l√Ω.zip`, zipBlob);
    });

    // Continue processing
    continueBtn.addEventListener('click', () => {
      files = [];
      processedResults = [];
      renderFileList();
      summaryCard.style.display = 'none';
      downloadAllBtn.style.display = 'none';
      topActions.style.display = 'none';
      resultList.innerHTML = '';
      showView('uploadView');
    });
  </script>
</body>

</html>